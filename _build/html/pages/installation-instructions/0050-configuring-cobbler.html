<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installing the OS using Fuel &mdash; Fuel for OpenStack 3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Fuel for OpenStack 3.0 documentation" href="../../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Fuel for OpenStack 3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installing the OS using Fuel</a><ul>
<li><a class="reference internal" href="#configuring-cobbler-with-config-yaml">Configuring Cobbler with config.yaml</a></li>
<li><a class="reference internal" href="#loading-the-configuration">Loading the configuration</a></li>
<li><a class="reference internal" href="#installing-the-operating-system">Installing the operating system</a></li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/pages/installation-instructions/0050-configuring-cobbler.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installing-the-os-using-fuel">
<span id="install-os-using-fuel"></span><h1>Installing the OS using Fuel<a class="headerlink" href="#installing-the-os-using-fuel" title="Permalink to this headline">¶</a></h1>
<p>The first step to creating OpenStack nodes is to let Fuel&#8217;s Cobbler kickstart and preseed files assist in the installation of operating systems on the target servers.</p>
<div class="section" id="configuring-cobbler-with-config-yaml">
<span id="configuring-cobbler"></span><h2>Configuring Cobbler with config.yaml<a class="headerlink" href="#configuring-cobbler-with-config-yaml" title="Permalink to this headline">¶</a></h2>
<p>Fuel uses the <tt class="docutils literal"><span class="pre">config.yaml</span></tt> file to configure Cobbler and assist in the configuration of the <tt class="docutils literal"><span class="pre">site.pp</span></tt> file.  This file appears in the <tt class="docutils literal"><span class="pre">/root</span></tt> directory when the master node (fuel-pm) is provisioned and configured.</p>
<p>You&#8217;ll want to configure this example to meet your own needs, but the example looks like this:</p>
<div class="highlight-python"><pre>common:
  orchestrator_common:
    attributes:
      deployment_mode: ha_compact
      deployment_engine: simplepuppet
    task_uuid: deployment_task</pre>
</div>
<p>Possible values for <tt class="docutils literal"><span class="pre">deployment_mode</span></tt> are <tt class="docutils literal"><span class="pre">singlenode_compute</span></tt>, <tt class="docutils literal"><span class="pre">multinode_compute</span></tt>, <tt class="docutils literal"><span class="pre">ha_compute</span></tt>, <tt class="docutils literal"><span class="pre">ha_compact</span></tt>, <tt class="docutils literal"><span class="pre">ha_full</span></tt>, and <tt class="docutils literal"><span class="pre">ha_minimal</span></tt>.  For this example, we will set the <tt class="docutils literal"><span class="pre">deployment_mode</span></tt> to <tt class="docutils literal"><span class="pre">ha_compact</span></tt> to tell Fuel to use HA architecture.  Specifying the <tt class="docutils literal"><span class="pre">simplepuppet</span></tt> deployment engine means that the orchestrator will be calling Puppet on each of the nodes.</p>
<p>Next you&#8217;ll need to set OpenStack&#8217;s networking information:</p>
<div class="highlight-python"><pre>openstack_common:
 internal_virtual_ip: 10.0.0.10
 public_virtual_ip: 192.168.0.10
 create_networks: true
 fixed_range: 172.16.0.0/16
 floating_range: 192.168.0.0/24</pre>
</div>
<p>Change the virtual IPs to match the target networks, and set the fixed and floating ranges.</p>
<div class="highlight-python"><pre>swift_loopback: loopback
nv_physical_volumes:
 - /dev/sdb</pre>
</div>
<p>By setting the <tt class="docutils literal"><span class="pre">nv_physical_volumes</span></tt> value, you are not only telling OpenStack to use this value for Cinder (you&#8217;ll see more about that in the <tt class="docutils literal"><span class="pre">site.pp</span></tt> file), but also where Cinder should store its data.</p>
<p>Later, we&#8217;ll set up a new partition for Cinder, so tell Cobbler to create it here.</p>
<div class="highlight-python"><pre>external_ip_info:
  public_net_router: 192.168.0.1
  ext_bridge: 0.0.0.0
  pool_start: 192.168.0.110
  pool_end: 192.168.0.126</pre>
</div>
<p>Set the <tt class="docutils literal"><span class="pre">public_net_router</span></tt> to point to the real router at the public network.  The <tt class="docutils literal"><span class="pre">ext_bridge</span></tt> is the IP of the Neutron (formerly Quantum) bridge. It should assigned to any available free IP on the public network that&#8217;s outside the floating range.  You also have the option to simply set it to <tt class="docutils literal"><span class="pre">0.0.0.0</span></tt>.  The <tt class="docutils literal"><span class="pre">pool_start</span></tt> and <tt class="docutils literal"><span class="pre">pool_end</span></tt> values represent the public addresses of your nodes, and should be within the <tt class="docutils literal"><span class="pre">floating_range</span></tt>.</p>
<div class="highlight-python"><pre>segment_range: 900:999
network_manager: nova.network.manager.FlatDHCPManager
auto_assign_floating_ip: true
quantum_netnode_on_cnt: true</pre>
</div>
<p>Fuel provides two choices for your network manager: FlatDHCPManager, and VlanManager.  By default, the system uses FlatDHCPManager.  Here you can see that we&#8217;re also telling OpenStack to automatically assing a floating IP to an instance when it&#8217;s created, and to put the Neutron services on the controllers rather than a sepearate node.You can also choose <tt class="docutils literal"><span class="pre">tenant_network_type</span></tt> for network segmentation type and  segmentation range <tt class="docutils literal"><span class="pre">segment_range</span></tt>  for network (consult Neutron documentation for details).</p>
<div class="highlight-python"><pre>use_syslog: false
syslog_server: 127.0.0.1
mirror_type: default</pre>
</div>
<p><strong>THIS SETTING IS CRUCIAL:</strong> The <tt class="docutils literal"><span class="pre">mirror_type</span></tt> <strong>must</strong> to be set to <tt class="docutils literal"><span class="pre">default</span></tt> unless you have your own repositories set up, or OpenStack will not install properly.</p>
<div class="highlight-python"><pre>quantum: true
internal_interface: eth0
public_interface: eth1
private_interface: eth2
public_netmask: 255.255.255.0
internal_netmask: 255.255.255.0</pre>
</div>
<p>Earlier, you decided which interfaces to use for which networks; note that here.</p>
<div class="highlight-python"><pre>default_gateway: 192.168.0.1</pre>
</div>
<p>Depending on how you&#8217;ve set up your network, you can either set the <tt class="docutils literal"><span class="pre">default_gateway</span></tt> to the master node (fuel-pm) or to the <tt class="docutils literal"><span class="pre">public_net_router</span></tt>.</p>
<div class="highlight-python"><pre>nagios_master: fuel-controller-01.localdomain
loopback: loopback
cinder: true
cinder_nodes:
- controller
swift: true</pre>
</div>
<p>The loopback setting determines how Swift stores data. If you set the value to <tt class="docutils literal"><span class="pre">loopback</span></tt>, Swift will use 1gb files as storage devices. If you tuned Cobbler to create a partition for Swift and mounted it to <tt class="docutils literal"><span class="pre">/srv/nodes/</span></tt>, then you should set <tt class="docutils literal"><span class="pre">loopback</span></tt> to <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<p>In this example, you&#8217;re using Cinder and including it on the compute nodes, so note that appropriately.  Also, you&#8217;re using Swift, so turn that on here.</p>
<div class="highlight-python"><pre>repo_proxy: http://10.0.0.100:3128</pre>
</div>
<p>One improvement in Fuel 2.1 was the ability for the master node to cache downloads in order to speed up installs; by default the <tt class="docutils literal"><span class="pre">repo_proxy</span></tt> is set to point to fuel-pm in order to let that happen.  One consequence of that is that your deployment will actually go faster if you let one install complete, then do all the others, rather than running all of them concurrently.</p>
<div class="highlight-python"><pre>deployment_id: '53'</pre>
</div>
<p>Fuel enables you to manage multiple clusters; setting the <tt class="docutils literal"><span class="pre">deployment_id</span></tt> will let Fuel know which deployment you&#8217;re working with.</p>
<div class="highlight-python"><pre>dns_nameservers:
- 10.0.0.100
- 8.8.8.8</pre>
</div>
<p>The slave nodes should first look to the master node for DNS, so mark that as your first nameserver.</p>
<p>The next step is to define the nodes themselves.  To do that, you&#8217;ll list each node once for each role that needs to be installed.  Note that by default the first node is called <tt class="docutils literal"><span class="pre">fuel-cobbler</span></tt>; change it to <tt class="docutils literal"><span class="pre">fuel-pm</span></tt>.</p>
<div class="highlight-python"><pre>nodes:
- name: fuel-pm
  role: cobbler
  internal_address: 10.0.0.100
  public_address: 192.168.0.100
- name: fuel-controller-01
  role: controller
  internal_address: 10.0.0.101
  public_address: 192.168.0.101
  swift_zone: 1
- name: fuel-controller-02
  role: controller
  internal_address: 10.0.0.102
  public_address: 192.168.0.102
  swift_zone: 2
- name: fuel-controller-03
  role: controller
  internal_address: 10.0.0.103
  public_address: 192.168.0.103
  swift_zone: 3
- name: fuel-controller-01
  role: quantum
  internal_address: 10.0.0.101
  public_address: 192.168.0.101
- name: fuel-compute-01
  role: compute
  internal_address: 10.0.0.110
  public_address: 192.168.0.110</pre>
</div>
<p>Notice that each node can be listed multiple times; this is because each node fulfills multiple roles.  Notice also that the IP address for fuel-compute-01 is <a href="#id1"><span class="problematic" id="id2">*</span></a>.110, not <a href="#id3"><span class="problematic" id="id4">*</span></a>.105.</p>
<p>The <tt class="docutils literal"><span class="pre">cobbler_common</span></tt> section applies to all machines:</p>
<div class="highlight-python"><pre>cobbler_common:
  # for Centos
  profile: "centos64_x86_64"
  # for Ubuntu
  # profile: "ubuntu_1204_x86_64"</pre>
</div>
<p>Fuel can install CentOS or Ubuntu on your servers, or you can add a profile of your own. By default, <tt class="docutils literal"><span class="pre">config.yaml</span></tt> uses CentOS.</p>
<div class="highlight-python"><pre>netboot-enabled: "1"
# for Ubuntu
# ksmeta: "puppet_version=2.7.19-1puppetlabs2 \
# for Centos
name-servers: "10.0.0.100"
name-servers-search: "localdomain"
gateway: 192.168.0.1</pre>
</div>
<p>Set the default nameserver to be fuel-pm, and change the domain name to your own domain name.  Set the <tt class="docutils literal"><span class="pre">gateway</span></tt> to the public network&#8217;s default gateway. Alternatively, if you don&#8217;t plan to use your public networks actual gateway, you can set this value to be the IP address of the master node.</p>
<p><strong>Please note:</strong> You must specify a working gateway (or proxy) in order to install OpenStack, because the system will need to communicate with public repositories.</p>
<div class="highlight-python"><pre>ksmeta: "puppet_version=2.7.19-1puppetlabs2 \
  puppet_auto_setup=1 \
  puppet_master=fuel-pm.localdomain \</pre>
</div>
<p>Change the fully-qualified domain name for the Puppet Master to reflect your own domain name.</p>
<div class="highlight-python"><pre>puppet_enable=0 \
ntp_enable=1 \
mco_auto_setup=1 \
mco_pskey=un0aez2ei9eiGaequaey4loocohjuch4Ievu3shaeweeg5Uthi \
mco_stomphost=10.0.0.100 \</pre>
</div>
<p>Make sure the <tt class="docutils literal"><span class="pre">mco_stomphost</span></tt> is set for the master node so that the orchestrator can find the nodes.</p>
<div class="highlight-python"><pre>mco_stompport=61613 \
mco_stompuser=mcollective \
mco_stomppassword=AeN5mi5thahz2Aiveexo \
mco_enable=1"</pre>
</div>
<p>This section sets the system up for orchestration; you shouldn&#8217;t have to touch it.</p>
<p>Next you&#8217;ll define the actual servers.</p>
<div class="highlight-python"><pre>fuel-controller-01:
  hostname: "fuel-controller-01"
  role: controller
  interfaces:
    eth0:
      mac: "08:00:27:BD:3A:7D"
      static: "1"
      ip-address: "10.0.0.101"
      netmask: "255.255.255.0"
      dns-name: "fuel-controller-01.localdomain"
      management: "1"
    eth1:
      mac: "08:00:27:ED:9C:3C"
      static: "0"
    eth2:
      mac: "08:00:27:B0:EB:2C"
      static: "1"
  interfaces_extra:
    eth0:
      peerdns: "no"
    eth1:
      peerdns: "no"
    eth2:
      promisc: "yes"
      userctl: "yes"
      peerdns: "no"</pre>
</div>
<p>For a VirtualBox installation, you can retrieve the MAC ids for your network adapters by expanding &#8220;Advanced&#8221; for the adapater in VirtualBox, or by executing ifconfig on the server itself.</p>
<p>For a physical installation, the MAC address of the server is often printed on the sticker attached to the server for the LOM interfaces, or is available from the BIOS screen.  You may also be able to find the MAC address in the hardware inventory BMC/DRAC/ILO, though this may be server-dependent.</p>
<p>Also, make sure the <tt class="docutils literal"><span class="pre">ip-address</span></tt> is correct, and that the <tt class="docutils literal"><span class="pre">dns-name</span></tt> has your own domain name in it.</p>
<p>In this example, IP addresses should be assigned as follows:</p>
<div class="highlight-python"><pre>fuel-controller-01:  10.0.0.101
fuel-controller-02:  10.0.0.102
fuel-controller-03:  10.0.0.103
fuel-compute-01:     10.0.0.110</pre>
</div>
<p>Repeat this step for each of the other controllers, and for the compute node.  Note that the compute node has its own role:</p>
<div class="highlight-python"><pre>fuel-compute-01:
  hostname: "fuel-compute-01"
  role: compute
  interfaces:
    eth0:
      mac: "08:00:27:AE:A9:6E"
      static: "1"
      ip-address: "10.0.0.110"
      netmask: "255.255.255.0"
      dns-name: "fuel-compute-01.localdomain"
      management: "1"
    eth1:
      mac: "08:00:27:B7:F9:CD"
      static: "0"
    eth2:
      mac: "08:00:27:8B:A6:B7"
      static: "1"
  interfaces_extra:
    eth0:
      peerdns: "no"
    eth1:
      peerdns: "no"
    eth2:
      promisc: "yes"
      userctl: "yes"
      peerdns: "no"</pre>
</div>
</div>
<div class="section" id="loading-the-configuration">
<h2>Loading the configuration<a class="headerlink" href="#loading-the-configuration" title="Permalink to this headline">¶</a></h2>
<p>Once you&#8217;ve completed the changes to <tt class="docutils literal"><span class="pre">config.yaml</span></tt>, you need to load the information into Cobbler.  To do that, use the <tt class="docutils literal"><span class="pre">cobbler_system</span></tt> script:</p>
<div class="highlight-python"><pre>cobbler_system -f config.yaml</pre>
</div>
<p>Now you&#8217;re ready to start spinning up the controllers and compute nodes.</p>
</div>
<div class="section" id="installing-the-operating-system">
<h2>Installing the operating system<a class="headerlink" href="#installing-the-operating-system" title="Permalink to this headline">¶</a></h2>
<p>Now that Cobbler has the correct configuration, the only thing you
need to do is to PXE-boot your nodes. This means that they will boot over the network, with
DHCP/TFTP provided by Cobbler, and will be provisioned accordingly,
with the specified operating system and configuration.</p>
<p>If you installed Fuel from the ISO, start fuel-controller-01 first and let the installation finish before starting the other nodes; Fuel will cache the downloads so subsequent installs will go faster.</p>
<p>The process for each node looks like this:</p>
<ol class="arabic">
<li><p class="first">Start the VM.</p>
</li>
<li><p class="first">Press F12 immediately and select l (LAN) as a bootable media.</p>
</li>
<li><p class="first">Wait for the installation to complete.</p>
</li>
<li><p class="first">Log into the new machine using root/r00tme.</p>
</li>
<li><p class="first"><strong>Change the root password.</strong></p>
</li>
<li><p class="first">Check that networking is set up correctly and the machine can reach the Internet:</p>
<div class="highlight-python"><pre>ping fuel-pm.localdomain
ping www.mirantis.com</pre>
</div>
</li>
</ol>
<p>If you&#8217;re unable to ping outside addresses, add the fuel-pm server as a default gateway:</p>
<div class="highlight-python"><pre>route add default gw 10.0.0.100</pre>
</div>
<p><strong>It is important to note</strong> that if you use VLANs in your network
configuration, you always have to keep in mind the fact that PXE
booting does not work on tagged interfaces. Therefore, all your nodes,
including the one where the Cobbler service resides, must share one
untagged VLAN (also called native VLAN). If necessary, you can use the
<tt class="docutils literal"><span class="pre">dhcp_interface</span></tt> parameter of the <tt class="docutils literal"><span class="pre">cobbler::server</span></tt> class to bind the DHCP
service to the appropriate interface.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Fuel for OpenStack 3.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mirantis.
      Last updated on 2013/07/22.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>